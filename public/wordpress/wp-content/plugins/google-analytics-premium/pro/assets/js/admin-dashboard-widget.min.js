;function MiWidgetPro(){var i=this,t=window.jQuery,o=window.monsterinsights_dashboard_widget,e=t(document.getElementById('monsterinsights_reports_widget')),r=e.find('.hndle'),n=e.find('.mi-dw-controls'),d=t(document.getElementById('welcome-panel')),l=t(document.getElementById('normal-sortables')),a=e.find('.mi-dw-reports-options'),s=e.find('.mi-dw-reports-content'),c=t(document.getElementById('mi-dw-report-template')).html(),p=t(document.getElementById('mi-dw-error-template')).html();this.init=function(){if(!this.is_authed()){return!1};this.add_widget_toggle();this.styled_toggle();this.dropdown_toggle();this.add_events();this.render_options();this.styled_checkboxes();this.tabs();this.tooltips();this.btn_group();this.apply_widget_settings();this.load_default()};this.state=o.widget_state;this.active_report='';this.set=function(t,e){if('undefined'===typeof this.state[t]){console.log('Unknown property to set');return};if('string'===typeof e&&this.state[t]===e){return!1};if('object'===typeof e&&JSON.stringify(this.state[t])===JSON.stringify(e)){return!1};this.state[t]=e;this.save_state()};this.get=function(e){if('undefined'===typeof this.state[e]){console.log('Unknown property to get: '+e);return!1};var i=this.state[e];if('object'===typeof i){i=t.extend(!0,{},i)};return i};this.save_state=function(){if(this.state_call){this.state_call.abort()};this.state_call=t.ajax({url:ajaxurl,method:'POST',dataType:'json',data:{action:'monsterinsights_save_widget_state',security:o.options_nonce,widget_state:i.state}})};this.add_events=function(){this.$widget_toggle.on('change',function(){i.toggle_widget_size(t(this))});a.on('change','input',function(){i.trigger_report_change(t(this))});s.on('click','.mi-dw-report-toggle',function(e){e.preventDefault();i.toggle_reports_accordion(t(this))});e.on('mi-btn-group-change',function(t,e){if(e.type&&'datepicker'===e.type){i.handle_interval_change(e.value)}});e.find('.mi-dw-reports-options').on('click',function(t){t.stopPropagation()})};this.apply_widget_settings=function(){if('full'===this.get('width')){this.$widget_toggle.prop('checked',!0).trigger('change')}};this.add_widget_toggle=function(){this.$widget_toggle=e.find('.mi-dw-widget-width-toggle')};this.toggle_widget_size=function(t){if(t.is(':checked')){e.insertAfter(d).addClass('mi-dw-full-width-widget');this.set('width','full');i.load_all_visible_reports()}
else{e.prependTo(l).removeClass('mi-dw-full-width-widget');this.set('width','regular')}};this.load_all_visible_reports=function(){var o=e.find('.mi-dw-report-toggle.visible:not(.mi-dw-active)');t.each(o,function(){var e=t(this);if(''===e.next().html()){i.load_report_data(e.data('report-type'),e.data('report-component'),e.next())}})};this.render_options=function(){var s=i.get('reports');i.render_report('overview','overview_top',!0);t.each(s,function(e,s){var n=t('<li />');if(o['reports_names'][e]){n.append('<span>'+o['reports_names'][e]+'</span>')};if(!t.isEmptyObject(s)){var r=t('<ul />');t.each(s,function(s,n){var d=t('<li />'),a=t('<label class="mi-dw-styled-checkboxes" />'),l=t('<input type="checkbox" data-report="'+e+'" data-component="'+s+'" />'),c='true'===n;l.prop('checked',c);a.append(l);if(o['reports_names'][s]){a.append(o['reports_names'][s])};d.append(a);r.append(d);i.render_report(e,s,c)});n.append(r)};a.append(n)});n.appendTo(r);e.addClass('mi-loaded')};this.trigger_report_change=function(o){var l=o.data('report'),a=o.data('component'),r=this.get('reports'),d=o.is(':checked'),n=t('[data-report-component="'+a+'"]');if(d){n.addClass('visible');if(''===n.next().html()){i.load_report_data(n.data('report-type'),a,n.next())};if(o.hasClass('monsterinsights-not-available')){return e.find('.monsterinsights-not-available').not(o).prop('checked',!1).trigger('change')}}
else{n.removeClass('visible').removeClass('mi-dw-active').next().removeClass('visible')};if(0===e.find('.monsterinsights-not-available:checked').length){s.removeClass('mi-dw-upsell-shown')}
else{s.addClass('mi-dw-upsell-shown')};r[l][a]=d;this.set('reports',r)};this.render_report=function(e,i,a){var r=t(c),n=r.first(),d=n.find('.monsterinsights-reports-uright-tooltip');if(o['reports_names'][i]){r.find('.mi-dw-report-title').text(o['reports_names'][i])};n.attr('data-report-type',e).attr('data-report-component',i).addClass('monsterinsights-report-'+e).addClass('monsterinsights-report-component-'+i);n.next().addClass('monsterinsights-report-component-'+i);if(a){n.addClass('visible')};if(o['reports_tooltips'][i]){d.attr('data-tooltip-title',o['reports_names'][i]).attr('data-tooltip-description',o['reports_tooltips'][i])}
else{d.hide()};s.append(r)};this.toggle_reports_accordion=function(t){s.find('.mi-dw-report-content').removeClass('visible');if(t.hasClass('mi-dw-active')){t.removeClass('mi-dw-active')}
else{s.find('.mi-dw-report-toggle').removeClass('mi-dw-active');var e=t.next();if(''===e.html()){this.load_report_data(t.data('report-type'),t.data('report-component'),e)};i.active_report=t.data('report-component');e.addClass('visible');t.addClass('mi-dw-active');this.maybe_scroll_into_view(t)}};this.maybe_scroll_into_view=function(t){var i=t.offset(),e=i.top-50,o=window.pageYOffset||document.documentElement.scrollTop;if(o>e){window.scrollTo(0,e)}};this.load_report_data=function(e,s,n){this.showLoader(n);t.ajax({url:ajaxurl,method:'POST',dataType:'json',data:{action:'monsterinsights_get_dashboard_widget_report',security:o.options_nonce,report:e,interval:i.get('interval'),component:s}}).done(function(t){if(t.success&&t.data.html){n.html(t.data.html);i.report_loaded_actions(s,t)}
else{var e=t.data.message?t.data.message:monsterinsights_dashboard_widget.error_default,o=t.data.data.footer?t.data.data.footer:!1;n.html(i.error_markup(monsterinsights_dashboard_widget.error_text,e,o))}})};this.handle_interval_change=function(e){i.set('interval',e);s.find('.mi-dw-report-content').empty();if('full'===this.get('width')){i.load_all_visible_reports()};var o=t('[data-report-component="'+i.active_report+'"]');if(o){i.load_report_data(o.data('report-type'),o.data('report-component'),o.next())}};this.styled_toggle=function(){var i=e.find('.mi-dw-styled-toggle');i.on('click',function(e){e.stopPropagation();t(document).trigger('click.monsterinsights');var i=t(this),o=i.find('input');o.is(':checked')?i.addClass('mi-dw-styled-toggle-checked'):i.removeClass('mi-dw-styled-toggle-checked')});i.on('change','input',function(e){var i=t(this),o=i.closest('.mi-dw-styled-toggle');i.is(':checked')?o.addClass('mi-dw-styled-toggle-checked'):o.removeClass('mi-dw-styled-toggle-checked')})};this.styled_checkboxes=function(){var i=e.find('.mi-dw-styled-checkboxes');i.on('change','input',function(e){var i=t(this),o=i.closest('.mi-dw-styled-checkboxes');i.is(':checked')?o.addClass('mi-dw-styled-checkbox-checked'):o.removeClass('mi-dw-styled-checkbox-checked')});t.each(i,function(){var e=t(this),i=t(this).find('[type="checkbox"]');i.is(':checked')?e.addClass('mi-dw-styled-checkbox-checked'):e.removeClass('mi-dw-styled-checkbox-checked')})};this.dropdown_toggle=function(){var o=e.find('.mi-dw-dropdown-toggle');o.on('click',function(e){e.stopPropagation();var o=t(this).parent();if(o.hasClass('mi-dw-open')){t(document).off('click.monsterinsights');return o.removeClass('mi-dw-open')};o.addClass('mi-dw-open');i.dropdown_close(o,o.find('ul').first())})};this.dropdown_close=function(e,i){t(document).on('click.monsterinsights',function(o){if(!i.is(o.target)){e.removeClass('mi-dw-open');t(document).off('click.monsterinsights')}})};this.load_default=function(){i.toggle_reports_accordion(t(document.querySelector('.mi-dw-report-toggle')))};this.tabs=function(){e.on('click','.monsterinsights-tabbed-nav-tab-title a',function(e){e.preventDefault();var i=t(this).parent(),n=i.data('tab');if(i.hasClass('active')){return!1};var o=t(this).closest('.monsterinsights-tabbed-nav'),s=o.parent();o.find('.active').removeClass('active');i.addClass('active');s.find('.monsterinsights-tabbed-nav-panel').hide();s.find('.'+n).show()})};this.tooltips=function(){t('body').tooltip({selector:'.monsterinsights-reports-uright-tooltip',items:'[data-tooltip-title], [data-tooltip-description]',content:function(){return'<div class="monsterinsights-reports-tooltip-title">'+jQuery(this).data('tooltip-title')+'</div><div class="monsterinsights-reports-tooltip-content">'+jQuery(this).data('tooltip-description')+'</div>'},tooltipClass:'monsterinsights-reports-ui-tooltip',position:{my:'right-10 top',at:'left top',collision:'flipfit'},hide:{duration:200},show:{duration:200},});t('.mi-dw-styled-toggle').tooltip({tooltipClass:'mi-dw-ui-tooltip',position:{my:'center bottom-12',at:'center top',collision:'flipfit'},})};this.showLoader=function(t){t.html('<div class="mi-dw-loading"></div>')};this.btn_group=function(){n.on('click','.mi-dw-btn-group-label',function(e){e.preventDefault();e.stopPropagation();var o=t(this).closest('.mi-dw-btn-group');if(o.hasClass('mi-dw-open')){o.removeClass('mi-dw-open');t(document).off('click.monsterinsights');return!1}
else{o.addClass('mi-dw-open')};i.dropdown_close(o,o.find('.mi-dw-btn-list').first())});n.on('click','.mi-dw-btn-group .mi-dw-btn',function(i){i.preventDefault();i.stopPropagation();var o=t(this);if(o.hasClass('selected')){return!1};var s=o.closest('.mi-dw-btn-group'),n=s.find('.mi-dw-btn-group-label');s.removeClass('mi-dw-open');s.find('.mi-dw-btn').removeClass('selected');o.addClass('selected');n.text(o.text());e.trigger('mi-btn-group-change',{type:s.data('type'),value:o.data('value')})})};this.report_loaded_actions=function(i,n){if('overview_top'===i){if(''!==o.default_tab){e.find('[data-tab="'+o.default_tab+'"] a').click()}};if('overview_top'===i||'infobox'===i||'addremove'===i){e.find('.monsterinsights-reports-infobox-title').each(function(){t(this).text(t.trim(t(this).text()))})};if(n.data.upsell){var a=e.find('[data-component="'+i+'"]'),r=e.find('.monsterinsights-report-component-'+i);a.addClass('monsterinsights-not-available');e.find('.monsterinsights-not-available').not(a).prop('checked',!1).trigger('change');r.addClass('mi-dw-upsell-loaded');s.addClass('mi-dw-upsell-shown')}};this.error_markup=function(e,i,o){var s=t(p);s.find('.mi-dw-error-title').html(e);s.find('.mi-dw-error-content').html(i);if(o){s.find('.mi-dw-error-footer').html(o).addClass('visible')};return s};this.is_authed=function(){return!(e.find('.mi-dw-not-authed').length>0)};window.uorigindetected='no';this.init()};new MiWidgetPro();